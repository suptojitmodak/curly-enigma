<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkShort | Free URL Shortener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1e40af;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .toast.show {
            opacity: 1;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.3;
        }
        .link-card {
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }
        .link-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
        }
        .social-icon {
            transition: all 0.2s ease;
        }
        .social-icon:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyAGntp_9Moqk54aWDIuqdR2uv-G3IhUXxU",
          authDomain: "link-shortner-project-fc9dc.firebaseapp.com",
          databaseURL: "https://link-shortner-project-fc9dc-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "link-shortner-project-fc9dc",
          storageBucket: "link-shortner-project-fc9dc.firebasestorage.app",
          messagingSenderId: "333006092673",
          appId: "1:333006092673:web:ed5927494b158703ad1080"
            };
            
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
    <div id="particles-js"></div>
    <div id="toast" class="toast"></div>
    <header class="bg-white shadow-sm py-4 px-6 sticky top-0 z-10">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="material-icons text-blue-600 text-2xl">insert_link</span>
                <h1 id="siteTitle" class="text-2xl font-bold text-blue-600"></h1>
            </div>
            <button id="newLinkBtn" class="flex items-center space-x-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105 shadow-md">
                <span class="material-icons text-sm">add</span>
                <span>New Link</span>
            </button>
        </div>
    </header>
    <main class="max-w-6xl mx-auto py-8 px-6">
        <section id="shortenerSection" class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-100">
            <h2 class="text-xl font-semibold mb-5 text-gray-800">Create Short Link</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Destination URL</label>
                    <input type="url" id="originalUrl" placeholder="https://example.com" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                    <p id="urlError" class="mt-1 text-sm text-red-600 hidden"></p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Custom Alias (optional)</label>
                    <div class="flex">
                        <span id="domainPrefix" class="inline-flex items-center px-4 bg-gray-100 border border-r-0 rounded-l-lg text-gray-600 text-sm"></span>
                        <input type="text" id="customSlug" placeholder="my-alias" 
                            class="flex-1 px-4 py-3 border rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                    </div>
                    <p id="slugError" class="mt-1 text-sm text-red-600 hidden"></p>
                </div>
                <button id="shortenBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-all duration-300 flex justify-center items-center space-x-2 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <span id="shortenText">Shorten URL</span>
                    <span id="shortenSpinner" class="loading-spinner hidden"></span>
                </button>
            </div>
        </section>
        <div id="resultSection" class="hidden bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-100">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Your Short Link</h3>
                <div class="flex items-center space-x-1 text-sm text-gray-500">
                    <span class="material-icons text-sm">visibility</span>
                    <span id="viewCount">0</span>
                    <span>views</span>
                </div>
            </div>
            <div class="flex items-center space-x-2 mb-4">
                <input type="text" id="shortUrl" readonly 
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 font-medium text-blue-600">
                <button id="copyBtn" class="p-3 rounded-lg hover:bg-gray-100 transition-all duration-200 shadow-sm">
                    <span class="material-icons text-gray-700">content_copy</span>
                </button>
            </div>
            <div class="flex space-x-3">
                <button id="qrBtn" class="flex-1 flex items-center justify-center space-x-2 bg-gray-100 hover:bg-gray-200 py-3 rounded-lg transition-all duration-200 text-sm shadow-sm">
                    <span class="material-icons text-sm">qr_code</span>
                    <span>QR Code</span>
                </button>
                <button id="shareBtn" class="flex-1 flex items-center justify-center space-x-2 bg-gray-100 hover:bg-gray-200 py-3 rounded-lg transition-all duration-200 text-sm shadow-sm">
                    <span class="material-icons text-sm">share</span>
                    <span>Share</span>
                </button>
            </div>
            <div class="mt-4 text-xs text-gray-500">
                Created: <span id="createdAt">just now</span>
            </div>
        </div>
        <section id="contentSection">
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-xl font-semibold text-gray-800">Recently Shorted Links</h2>
                <button id="refreshBtn" class="text-blue-600 hover:text-blue-800 flex items-center space-x-1 text-sm transition-all duration-200">
                    <span class="material-icons text-sm">refresh</span>
                    <span>Refresh</span>
                </button>
            </div>
            <div id="contentList" class="space-y-4">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <p class="text-gray-500 text-center">No links created yet</p>
                </div>
            </div>
        </section>
    </main>
    <div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl p-6 max-w-xs w-full shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">QR Code</h3>
                <button id="closeQrModal" class="text-gray-500 hover:text-gray-700 transition-all duration-200">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div id="qrCode" class="flex justify-center mb-4"></div>
            <p class="text-center text-sm text-gray-600 mb-4">Scan to visit the link</p>
            <button id="downloadQrBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                Download QR Code
            </button>
        </div>
    </div>
    <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl p-6 max-w-xs w-full shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Share Link</h3>
                <button id="closeShareModal" class="text-gray-500 hover:text-gray-700 transition-all duration-200">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="flex justify-center space-x-4 mb-6">
                <a href="#" id="twitterShare" class="social-icon bg-blue-400 hover:bg-blue-500 text-white p-3 rounded-full transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                    </svg>
                </a>
                <a href="#" id="facebookShare" class="social-icon bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/>
                    </svg>
                </a>
                <a href="#" id="linkedinShare" class="social-icon bg-blue-800 hover:bg-blue-900 text-white p-3 rounded-full transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                    </svg>
                </a>
                <a href="#" id="whatsappShare" class="social-icon bg-green-500 hover:bg-green-600 text-white p-3 rounded-full transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.515 5.392 1.521 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/>
                    </svg>
                </a>
            </div>
            <input type="text" id="shareUrl" readonly class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 mb-4">
            <button id="copyShareBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                Copy Link
            </button>
        </div>
    </div>

    <script>
        const toast = document.getElementById('toast');
        const originalUrlInput = document.getElementById('originalUrl');
        const customSlugInput = document.getElementById('customSlug');
        const shortenBtn = document.getElementById('shortenBtn');
        const shortenText = document.getElementById('shortenText');
        const shortenSpinner = document.getElementById('shortenSpinner');
        const resultSection = document.getElementById('resultSection');
        const shortUrlElement = document.getElementById('shortUrl');
        const viewCountElement = document.getElementById('viewCount');
        const createdAtElement = document.getElementById('createdAt');
        const copyBtn = document.getElementById('copyBtn');
        const qrBtn = document.getElementById('qrBtn');
        const shareBtn = document.getElementById('shareBtn');
        const qrModal = document.getElementById('qrModal');
        const shareModal = document.getElementById('shareModal');
        const closeQrModal = document.getElementById('closeQrModal');
        const closeShareModal = document.getElementById('closeShareModal');
        const qrCodeElement = document.getElementById('qrCode');
        const downloadQrBtn = document.getElementById('downloadQrBtn');
        const newLinkBtn = document.getElementById('newLinkBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const contentList = document.getElementById('contentList');
        const urlError = document.getElementById('urlError');
        const slugError = document.getElementById('slugError');
        const shareUrl = document.getElementById('shareUrl');
        const copyShareBtn = document.getElementById('copyShareBtn');
        const twitterShare = document.getElementById('twitterShare');
        const facebookShare = document.getElementById('facebookShare');
        const linkedinShare = document.getElementById('linkedinShare');
        const whatsappShare = document.getElementById('whatsappShare');
        const siteTitle = document.getElementById('siteTitle');
        const domainPrefix = document.getElementById('domainPrefix');
        siteTitle.textContent = window.location.hostname;
        domainPrefix.textContent = window.location.origin.replace(/^https?:\/\//, '') + "/";
        particlesJS("particles-js", {
            "particles": {
                "number": {
                    "value": 80,
                    "density": {
                        "enable": true,
                        "value_area": 800
                    }
                },
                "color": {
                    "value": "#3b82f6"
                },
                "shape": {
                    "type": "circle",
                    "stroke": {
                        "width": 0,
                        "color": "#000000"
                    },
                    "polygon": {
                        "nb_sides": 5
                    }
                },
                "opacity": {
                    "value": 0.3,
                    "random": false,
                    "anim": {
                        "enable": false,
                        "speed": 1,
                        "opacity_min": 0.1,
                        "sync": false
                    }
                },
                "size": {
                    "value": 3,
                    "random": true,
                    "anim": {
                        "enable": false,
                        "speed": 40,
                        "size_min": 0.1,
                        "sync": false
                    }
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#3b82f6",
                    "opacity": 0.2,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 2,
                    "direction": "none",
                    "random": false,
                    "straight": false,
                    "out_mode": "out",
                    "bounce": false,
                    "attract": {
                        "enable": false,
                        "rotateX": 600,
                        "rotateY": 1200
                    }
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": true,
                        "mode": "grab"
                    },
                    "onclick": {
                        "enable": true,
                        "mode": "push"
                    },
                    "resize": true
                },
                "modes": {
                    "grab": {
                        "distance": 140,
                        "line_linked": {
                            "opacity": 1
                        }
                    },
                    "bubble": {
                        "distance": 400,
                        "size": 40,
                        "duration": 2,
                        "opacity": 8,
                        "speed": 3
                    },
                    "repulse": {
                        "distance": 200,
                        "duration": 0.4
                    },
                    "push": {
                        "particles_nb": 4
                    },
                    "remove": {
                        "particles_nb": 2
                    }
                }
            },
            "retina_detect": true
        });
        const linksRef = database.ref('links');
        function showToast(message, duration = 3000) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        function generateSlug() {
            return Math.random().toString(36).substring(2, 8);
        }
        function formatDate(date) {
            const now = new Date();
            const diff = now - new Date(date);
            const seconds = Math.floor(diff / 1000);
            
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} min ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
            return new Date(date).toLocaleDateString();
        }
        function isValidUrl(url) {
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }
        function isValidSlug(slug) {
            return /^[a-z0-9_-]+$/i.test(slug);
        }
        async function createShortLink() {
            const originalUrl = originalUrlInput.value.trim();
            let customSlug = customSlugInput.value.trim();
            if (!originalUrl) {
                urlError.textContent = 'Please enter a URL';
                urlError.classList.remove('hidden');
                originalUrlInput.focus();
                return;
            }
            if (!isValidUrl(originalUrl)) {
                urlError.textContent = 'Please enter a valid URL (include http:// or https://)';
                urlError.classList.remove('hidden');
                originalUrlInput.focus();
                return;
            }
            urlError.classList.add('hidden');
            if (customSlug) {
                if (!isValidSlug(customSlug)) {
                    slugError.textContent = 'Only letters, numbers, hyphens and underscores allowed';
                    slugError.classList.remove('hidden');
                    customSlugInput.focus();
                    return;
                }
                const slugExists = await checkSlugExists(customSlug);
                if (slugExists) {
                    slugError.textContent = 'This alias is already taken';
                    slugError.classList.remove('hidden');
                    customSlugInput.focus();
                    return;
                }
                slugError.classList.add('hidden');
            } else {
                customSlug = generateSlug();
            }
            shortenText.classList.add('hidden');
            shortenSpinner.classList.remove('hidden');
            shortenBtn.disabled = true;
            const createdAt = new Date().toISOString();
            const shortUrl = `${window.location.origin}/${customSlug}`;
            try {
                await linksRef.child(customSlug).set({
                    originalUrl: originalUrl,
                    createdAt: createdAt,
                    viewCount: 0
                });
                shortUrlElement.value = shortUrl;
                shareUrl.value = shortUrl;
                viewCountElement.textContent = '0';
                createdAtElement.textContent = formatDate(createdAt);
                resultSection.classList.remove('hidden');
                QRCode.toCanvas(qrCodeElement, shortUrl, {
                    width: 200,
                    margin: 2,
                    color: {
                        dark: '#2563eb',
                        light: '#ffffff'
                    }
                });
                showToast('Link shorted successfully!');
                loadLinks();
                setTimeout(() => {
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } catch (error) {
                console.error("Error saving link:", error);
                showToast('Failed to short link. Please try again.');
            }
            shortenText.classList.remove('hidden');
            shortenSpinner.classList.add('hidden');
            shortenBtn.disabled = false;
        }
        async function checkSlugExists(slug) {
            const snapshot = await linksRef.child(slug).once('value');
            return snapshot.exists();
        }
        async function loadLinks() {
            try {
                const snapshot = await linksRef.orderByChild('createdAt').once('value');
                const links = snapshot.val() || {};
                
                const linksArray = Object.keys(links).map(slug => ({
                    slug,
                    ...links[slug]
                }));
                linksArray.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                if (linksArray.length === 0) {
                    contentList.innerHTML = `
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                            <p class="text-gray-500 text-center">No links created yet</p>
                        </div>
                    `;
                    return;
                }
                
                contentList.innerHTML = '';
                
                linksArray.forEach(link => {
                    const shortUrl = `${window.location.origin}/${link.slug}`;
                    const linkElement = document.createElement('div');
                    linkElement.className = 'link-card bg-white p-5 rounded-xl shadow-sm border border-gray-200';
                    linkElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-blue-600 truncate">${shortUrl}</p>
                                <div class="flex items-center mt-3 text-xs text-gray-500">
                                    <span>${link.viewCount || 0} views</span>
                                    <span class="mx-1">•</span>
                                    <span>${formatDate(link.createdAt)}</span>
                                </div>
                            </div>
                            <div class="flex space-x-1 ml-2">
                                <button class="copy-link p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100" data-url="${shortUrl}" title="Copy">
                                    <span class="material-icons text-sm">content_copy</span>
                                </button>
                                <button class="share-link p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100" data-url="${shortUrl}" title="Share">
                                    <span class="material-icons text-sm">share</span>
                                </button>
                                <a href="${shortUrl}" target="_blank" class="p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100" title="Open">
                                    <span class="material-icons text-sm">open_in_new</span>
                                </a>
                            </div>
                        </div>
                    `;
                    contentList.appendChild(linkElement);
                });
                
                // Add copy event listeners
                document.querySelectorAll('.copy-link').forEach(btn => {
                    btn.addEventListener('click', () => {
                        navigator.clipboard.writeText(btn.getAttribute('data-url'));
                        showToast('Link copied to clipboard!');
                    });
                });
                
                // Add share event listeners
                document.querySelectorAll('.share-link').forEach(btn => {
                    btn.addEventListener('click', () => {
                        shareUrl.value = btn.getAttribute('data-url');
                        shareModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                        setupSocialSharing();
                    });
                });
                
            } catch (error) {
                console.error("Error loading links:", error);
                showToast('Failed to load links. Please try again.');
            }
        }

        // Check for redirect
        async function checkForRedirect() {
            const path = window.location.pathname.substring(1); // Remove leading slash
            if (path) {
                try {
                    const snapshot = await linksRef.child(path).once('value');
                    const link = snapshot.val();
                    
                    if (link && link.originalUrl) {
                        // Increment view count
                        await linksRef.child(path).update({
                            viewCount: (link.viewCount || 0) + 1
                        });
                        
                        // Redirect
                        window.location.href = link.originalUrl;
                    } else {
                        // Invalid link, show main page
                        showToast('Invalid or expired link');
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                } catch (error) {
                    console.error("Error checking redirect:", error);
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
        }

        // Download QR code
        function downloadQRCode() {
            const canvas = qrCodeElement.querySelector('canvas');
            if (!canvas) return;
            
            const link = document.createElement('a');
            link.download = `linkshort-${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Setup social sharing
        function setupSocialSharing() {
            const currentUrl = encodeURIComponent(shareUrl.value);
            const text = encodeURIComponent("Check out this link: ");
            
            twitterShare.href = `https://twitter.com/intent/tweet?text=${text}&url=${currentUrl}`;
            facebookShare.href = `https://www.facebook.com/sharer/sharer.php?u=${currentUrl}`;
            linkedinShare.href = `https://www.linkedin.com/shareArticle?mini=true&url=${currentUrl}`;
            whatsappShare.href = `https://wa.me/?text=${text}${currentUrl}`;
        }

        // Event Listeners
        shortenBtn.addEventListener('click', createShortLink);
        
        newLinkBtn.addEventListener('click', () => {
            originalUrlInput.value = '';
            customSlugInput.value = '';
            resultSection.classList.add('hidden');
            urlError.classList.add('hidden');
            slugError.classList.add('hidden');
            originalUrlInput.focus();
        });
        
        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(shortUrlElement.value);
            showToast('Link copied to clipboard!');
        });
        
        qrBtn.addEventListener('click', () => {
            qrModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        });
        
        shareBtn.addEventListener('click', () => {
            shareModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setupSocialSharing();
        });
        
        closeQrModal.addEventListener('click', () => {
            qrModal.classList.add('hidden');
            document.body.style.overflow = '';
        });
        
        closeShareModal.addEventListener('click', () => {
            shareModal.classList.add('hidden');
            document.body.style.overflow = '';
        });
        
        downloadQrBtn.addEventListener('click', downloadQRCode);
        
        copyShareBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(shareUrl.value);
            showToast('Link copied to clipboard!');
            shareModal.classList.add('hidden');
            document.body.style.overflow = '';
        });
        
        refreshBtn.addEventListener('click', () => {
            loadLinks();
            showToast('Links refreshed');
        });
        
        // Handle Enter key
        originalUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') createShortLink();
        });
        
        customSlugInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') createShortLink();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkForRedirect();
            loadLinks();
        });
    </script>
</body>
                </html>
